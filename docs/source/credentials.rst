Credentials
===========

The ``GPPClient`` supports multiple methods for authenticating with the GPP GraphQL API.
This page describes how credentials are resolved and how to configure them.

Credential Resolution Order
---------------------------

When creating a ``GPPClient`` instance, credentials are resolved in the following order:

1. **Direct constructor arguments**:

   If ``url`` and ``token`` are passed directly to ``GPPClient``, they take precedence.

   .. code-block:: python

      from gpp_client import GPPClient

      client = GPPClient(
          url="https://your-url-here.com",
          token="your_token_here"
      )

2. **Environment variables**:

   If no arguments are passed, the client checks for:

   - ``GPP_URL``
   - ``GPP_TOKEN``

   You can set these in your shell environment:

   .. code-block:: bash

      export GPP_URL="https://your-url-here.com"
      export GPP_TOKEN="your_token_here"

3. **TOML configuration file**:

   If neither arguments nor environment variables are provided, the client looks for a config file generated by ``GPPConfig``.

   On POSIX systems (Linux, macOS), the config file is located at:

   .. code-block:: text

      ~/.gpp-client/config.toml

   On Windows systems, the config file is located in the user's **Roaming** AppData directory:

   .. code-block:: text

      C:\Users\<username>\AppData\Roaming\GPP Client\config.toml

   Example contents:

   .. code-block:: toml

      [credentials]
      url = "https://your-url-here.com"
      token = "your_token_here"

If neither ``url`` nor ``token`` can be resolved from any source, a ``ValueError`` will be raised at runtime.

Setting Credentials
-------------------

You can create or update the stored credentials directly without manually editing the config file.

From Python
^^^^^^^^^^^

.. code-block:: python

   from gpp_client import GPPClient

   GPPClient.set_credentials(
       url="https://your-url-here.com",
       token="your_token_here"
   )

This will automatically create (or update) the configuration file in the appropriate application directory.

From CLI (optional)
^^^^^^^^^^^^^^^^^^^

If CLI support is installed, you can also set credentials using the CLI:

.. code-block:: bash

   gpp config auth --url "https://your-url-here.com" --token "your_token_here"

This performs the same operation as calling ``GPPClient.set_credentials()`` in Python.

Configuration File Format
-------------------------

The configuration file must include:

- ``url``: The full GPP GraphQL endpoint URL.
- ``token``: Your personal access token.

Example:

.. code-block:: toml

   [credentials]
   url = "https://your-url-here.com"
   token = "your_token_here"
