query GetSchedulerPrograms{
  programs(
    WHERE: {
      AND: [
        { reference: { semester: { EQ: "2024B" } } }
        { proposalStatus: { EQ: ACCEPTED } }
      ]
    }
  ) {
    matches {
      id
      proposal {
        type {
          scienceSubtype
        }
      }
    }
  }
}


fragment SchedulerAtomStep on GmosNorthStep{
   instrumentConfig{
       exposure{
        seconds
       }
       readout{
        xBin
        yBin
       }
       dtax
       roi
       gratingConfig{
         grating
         wavelength{
           nanometers
         }
       }
       filter
       fpu{
         builtin
       }
       centralWavelength{
         nanometers
       }
    }
    breakpoint
    estimate{
        total{
            seconds
        }
    }
    observeClass
    stepConfig{
      stepType
      ... on Gcal {
        continuum
        arcs
        filter
        diffuser
        shutter
      }
    }
    telescopeConfig{
      offset{
        p{
          arcseconds
        }
        q{
          arcseconds
        }
      }
    }
}

fragment SchedulerAtomStepNorth on GmosNorthStep{
   instrumentConfig{
       exposure{
        seconds
       }
       readout{
        xBin
        yBin
       }
       dtax
       roi
       gratingConfig{
         grating
         wavelength{
           nanometers
         }
       }
       filter
       fpu{
         builtin
       }
       centralWavelength{
         nanometers
       }
    }
    breakpoint
    estimate{
        total{
            seconds
        }
    }
    observeClass
    stepConfig{
      __typename
      stepType
      ... on Gcal {
        continuum
        arcs
        filter
        diffuser
        shutter
      }
    }
    telescopeConfig{
      offset{
        p{
          arcseconds
        }
        q{
          arcseconds
        }
      }
    }
}

fragment SchedulerAtomStepSouth on GmosSouthStep{
   instrumentConfig{
       exposure{
        seconds
       }
       readout{
        xBin
        yBin
       }
       dtax
       roi
       gratingConfig{
         grating
         wavelength{
           nanometers
         }
       }
       filter
       fpu{
         builtin
       }
       centralWavelength{
         nanometers
       }
    }
    breakpoint
    estimate{
        total{
            seconds
        }
    }
    observeClass
    stepConfig{
      __typename
      stepType
      ... on Gcal {
        continuum
        arcs
        filter
        diffuser
        shutter
      }
    }
    telescopeConfig{
      offset{
        p{
          arcseconds
        }
        q{
          arcseconds
        }
      }
    }
}




query getSequence($obsId: ObservationId){
  observations(WHERE:{
    id:{
      EQ:$obsId
    }
  }){
    matches{
      id
      execution{
        atomRecords{
          matches{
            instrument
            steps{
              matches{
                executionState
                interval{
                  duration{
                    seconds
                  }
                }
                stepConfig{
                  __typename
                  stepType
                  ... on Gcal {
                    continuum
                    arcs
                    filter
                    diffuser
                    shutter
                    }


                }
                observeClass
                qaState
                telescopeConfig{
                  offset{
                    p{
                      arcseconds
                    }
                    q{
                      arcseconds
                    }
                  }
                }
                gmosNorth{
                  exposure{
                    seconds
                  }
                  readout{
                    xBin
                    yBin
                  }
                  dtax
                  roi
                  gratingConfig{
                    grating
                    wavelength{
                      nanometers
                    }
                  }
                  filter
                  fpu{
                    builtin
                  }
                  centralWavelength{
                    nanometers
                  }

                }
                instrument
                gmosSouth{
                  exposure{
                    seconds
                  }
                  readout{
                    xBin
                    yBin
                  }
                  dtax
                  roi
                  gratingConfig{
                    grating
                    wavelength{
                      nanometers
                    }
                  }
                  filter
                  fpu{
                    builtin
                  }
                  centralWavelength{
                    nanometers
                  }
                }
              }

            }
          }
        }
        config{
          instrument
          gmosNorth{
            acquisition{
                nextAtom{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepNorth
                    }
                }
                possibleFuture{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepNorth
                    }
                }
            }
            science{
                nextAtom{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepNorth
                    }
                }
                possibleFuture{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepNorth
                    }
                }
            }
          }
          gmosSouth{
             acquisition{
                nextAtom{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepSouth
                    }
                }
                possibleFuture{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepSouth
                    }
                }
            }
            science{
                nextAtom{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepSouth
                    }
                }
                possibleFuture{
                    description
                    observeClass
                    steps{
                        ...SchedulerAtomStepSouth
                    }
                }
            }
          }
        }
      }
    }
  }
}
